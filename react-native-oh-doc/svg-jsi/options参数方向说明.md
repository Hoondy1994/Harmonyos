# options å‚æ•°æ–¹å‘è¯´æ˜

## âŒ é”™è¯¯ç†è§£

**ç†è§£**: `options` æ˜¯ JavaScript â†” C++ é€šç”¨çš„ï¼ˆåŒå‘ä¼ å€¼ï¼‰

**é—®é¢˜**: è™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥å®ç°ï¼Œä½†åœ¨å½“å‰ä»£ç ä¸­ `options` åªæ˜¯**è¾“å…¥**ï¼ˆJavaScript â†’ C++ï¼‰

---

## âœ… å½“å‰å®ç°ï¼šoptions åªæ˜¯è¾“å…¥

### ä»£ç è¯æ®

```cpp
jsi::Object RNSVGSvgViewModule::getSVGSize(jsi::Runtime &rt, Int32_t tag, Object options) {
    // ...
    
    if (options.has_value()) {
        // âœ… åªè¯»å– optionsï¼ˆè¾“å…¥ï¼‰
        const jsi::Object& opts = *options;  // const å¼•ç”¨ï¼Œåªè¯»
        
        // è¯»å–å±æ€§
        if (opts.hasProperty(rt, "unit")) {
            std::string unitStr = opts.getProperty(rt, "unit").asString(rt).utf8(rt);
            // åªæ˜¯è¯»å–ï¼Œæ²¡æœ‰ä¿®æ”¹
        }
        // ...
    }
    
    // åˆ›å»ºæ–°çš„è¿”å›å¯¹è±¡ï¼ˆè¾“å‡ºï¼‰
    jsi::Object result(rt);
    result.setProperty(rt, "width", jsi::Value(width));
    // ...
    
    return result;  // â† è¿”å›å€¼æ‰æ˜¯è¾“å‡º
}
```

**å…³é”®ç‚¹**:
- `const jsi::Object& opts = *options;` - ä½¿ç”¨ `const`ï¼Œåªè¯»
- åªè°ƒç”¨ `getProperty()` - è¯»å–æ“ä½œ
- æ²¡æœ‰è°ƒç”¨ `setProperty()` - æ²¡æœ‰ä¿®æ”¹ `options`
- è¿”å›å€¼æ˜¯ `result`ï¼Œä¸æ˜¯ `options`

---

## ğŸ“Š å½“å‰çš„ä¼ å€¼æ–¹å‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript è°ƒç”¨                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  const options = { unit: 'px', scale: 1.5 };               â”‚
â”‚  const result = module.getSVGSize(tag, options);           â”‚
â”‚                              â†‘        â†‘                     â”‚
â”‚                        JavaScript â†’ C++                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C++ å‡½æ•°æ‰§è¡Œ                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  // options: åªè¯»ï¼ˆè¾“å…¥ï¼‰                                    â”‚
â”‚  const jsi::Object& opts = *options;                        â”‚
â”‚  std::string unit = opts.getProperty(rt, "unit")...;       â”‚
â”‚                                                              â”‚
â”‚  // result: æ–°å»ºï¼ˆè¾“å‡ºï¼‰                                     â”‚
â”‚  jsi::Object result(rt);                                    â”‚
â”‚  result.setProperty(rt, "width", ...);                      â”‚
â”‚                                                              â”‚
â”‚  return result;  // C++ â†’ JavaScript                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript æ¥æ”¶                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  const result = {                                           â”‚
â”‚    width: 150,                                              â”‚
â”‚    height: 150                                              â”‚
â”‚  };                                                         â”‚
â”‚                                                              â”‚
â”‚  // options æ²¡æœ‰è¢«ä¿®æ”¹                                       â”‚
â”‚  console.log(options);  // è¿˜æ˜¯ { unit: 'px', scale: 1.5 } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æŠ€æœ¯ä¸Šå¯ä»¥å®ç°"åŒå‘"ï¼Œä½†ä¸æ¨è

### æ–¹å¼ 1: ä¿®æ”¹ options å¯¹è±¡ï¼ˆä¸æ¨èï¼‰

```cpp
jsi::Object RNSVGSvgViewModule::getSVGSize(jsi::Runtime &rt, Int32_t tag, Object options) {
    if (options.has_value()) {
        // âŒ ä¸æ¨èï¼šä¿®æ”¹è¾“å…¥å‚æ•°
        jsi::Object& opts = *const_cast<jsi::Object*>(&(*options));
        
        // è¯»å–è¾“å…¥
        std::string unit = opts.getProperty(rt, "unit").asString(rt).utf8(rt);
        
        // å†™å…¥è¾“å‡ºï¼ˆä¿®æ”¹ optionsï¼‰
        opts.setProperty(rt, "resultWidth", jsi::Value(150.0));
        opts.setProperty(rt, "resultHeight", jsi::Value(150.0));
    }
    
    // è¿”å›ä¿®æ”¹åçš„ options
    return *options;
}
```

**é—®é¢˜**:
- ä¿®æ”¹è¾“å…¥å‚æ•°ï¼Œç ´åå‡½æ•°å¼ç¼–ç¨‹åŸåˆ™
- ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼ˆè¾“å…¥è¢«æ”¹å˜ï¼‰
- éš¾ä»¥è°ƒè¯•

---

### æ–¹å¼ 2: é€šè¿‡è¿”å›å€¼ä¼ é€’ç»“æœï¼ˆæ¨è âœ…ï¼‰

```cpp
jsi::Object RNSVGSvgViewModule::getSVGSize(jsi::Runtime &rt, Int32_t tag, Object options) {
    // è¯»å– optionsï¼ˆè¾“å…¥ï¼‰
    if (options.has_value()) {
        const jsi::Object& opts = *options;
        // è¯»å–é…ç½®...
    }
    
    // åˆ›å»ºæ–°çš„è¿”å›å¯¹è±¡ï¼ˆè¾“å‡ºï¼‰
    jsi::Object result(rt);
    result.setProperty(rt, "width", jsi::Value(150.0));
    result.setProperty(rt, "height", jsi::Value(150.0));
    
    return result;  // è¿”å›å€¼æ˜¯è¾“å‡º
}
```

**ä¼˜ç‚¹**:
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼šè¾“å…¥ vs è¾“å‡º
- ä¸ä¿®æ”¹è¾“å…¥å‚æ•°
- æ˜“äºç†è§£å’Œç»´æŠ¤

---

## ğŸ“‹ å‚æ•°æ–¹å‘æ€»ç»“

### å½“å‰å®ç°ï¼ˆæ¨èæ–¹å¼ï¼‰

| å‚æ•°/è¿”å›å€¼ | æ–¹å‘ | ç”¨é€” |
|------------|------|------|
| `rt` | æ¡†æ¶è‡ªåŠ¨ä¼ é€’ | å·¥å…·æ¥å£ï¼Œä¸æ˜¯æ•°æ® |
| `tag` | JavaScript â†’ C++ | è¾“å…¥ï¼šç»„ä»¶ ID |
| `options` | JavaScript â†’ C++ | è¾“å…¥ï¼šé…ç½®é€‰é¡¹ |
| **è¿”å›å€¼** | C++ â†’ JavaScript | **è¾“å‡º**ï¼šç»“æœå¯¹è±¡ |

---

### å¦‚æœå®ç°"åŒå‘"ï¼ˆä¸æ¨èï¼‰

| å‚æ•°/è¿”å›å€¼ | æ–¹å‘ | ç”¨é€” |
|------------|------|------|
| `rt` | æ¡†æ¶è‡ªåŠ¨ä¼ é€’ | å·¥å…·æ¥å£ |
| `tag` | JavaScript â†’ C++ | è¾“å…¥ï¼šç»„ä»¶ ID |
| `options` | JavaScript â†” C++ | è¾“å…¥ + è¾“å‡ºï¼šæ—¢è¯»å–åˆä¿®æ”¹ |
| è¿”å›å€¼ | - | å¯èƒ½è¿”å›ä¿®æ”¹åçš„ options |

---

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

### âœ… æ¨èï¼šæ¸…æ™°çš„è¾“å…¥è¾“å‡ºåˆ†ç¦»

```typescript
// JavaScript
const options = { unit: 'px' };  // è¾“å…¥
const result = module.getSVGSize(tag, options);  // è¿”å›å€¼æ˜¯è¾“å‡º
console.log(result.width);  // ä½¿ç”¨è¿”å›å€¼
```

```cpp
// C++
jsi::Object getSVGSize(rt, tag, options) {
    // options: åªè¯»è¾“å…¥
    // return: æ–°å»ºçš„è¾“å‡ºå¯¹è±¡
}
```

---

### âŒ ä¸æ¨èï¼šä¿®æ”¹è¾“å…¥å‚æ•°

```typescript
// JavaScript
const options = { unit: 'px' };
module.getSVGSize(tag, options);
console.log(options.width);  // âŒ è¾“å…¥è¢«æ”¹å˜äº†ï¼Ÿä¸å¯é¢„æµ‹ï¼
```

```cpp
// C++
jsi::Object getSVGSize(rt, tag, options) {
    // ä¿®æ”¹ optionsï¼ˆç ´åè¾“å…¥ï¼‰
    options->setProperty(rt, "width", ...);  // âŒ
}
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆé€‰é¡¹åªæ˜¯è¾“å…¥ï¼Ÿ

### 1. å‡½æ•°å¼ç¼–ç¨‹åŸåˆ™

- **çº¯å‡½æ•°**: ä¸ä¿®æ”¹è¾“å…¥ï¼Œåªè¿”å›è¾“å‡º
- **å¯é¢„æµ‹æ€§**: è¾“å…¥ä¸ä¼šè¢«æ„å¤–æ”¹å˜
- **å¯æµ‹è¯•æ€§**: ç›¸åŒçš„è¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„è¾“å‡º

---

### 2. æ¸…æ™°çš„æ¥å£è®¾è®¡

```
è¾“å…¥ â†’ å‡½æ•° â†’ è¾“å‡º
 â†‘              â†‘
æ˜ç¡®           æ˜ç¡®
```

vs

```
è¾“å…¥ï¼ˆä¹Ÿå¯èƒ½å˜æˆè¾“å‡ºï¼‰â†’ å‡½æ•° â†’ ?
      â†‘
   ä¸æ˜ç¡®
```

---

### 3. React Native çº¦å®š

åœ¨ React Native ä¸­ï¼Œå¸¸è§çš„æ¨¡å¼æ˜¯ï¼š
- **è¾“å…¥å‚æ•°**: ç”¨äºä¼ é€’é…ç½®
- **è¿”å›å€¼**: ç”¨äºè¿”å›ç»“æœ
- **å›è°ƒå‡½æ•°**: ç”¨äºå¼‚æ­¥ç»“æœï¼ˆå¦‚ `toDataURL`ï¼‰

---

## ğŸ” å¯¹æ¯”ï¼štoDataURL çš„å¼‚æ­¥æ¨¡å¼

### toDataURL: ä½¿ç”¨å›è°ƒè¿”å›ç»“æœ

```cpp
void toDataURL(rt, tag, options, callback)
//            â†‘    â†‘      â†‘         â†‘
//         å·¥å…·  è¾“å…¥   è¾“å…¥      è¾“å‡ºï¼ˆå›è°ƒï¼‰
```

```typescript
// JavaScript
module.toDataURL(tag, options, (result) => {
  // result æ˜¯è¾“å‡ºï¼ˆé€šè¿‡å›è°ƒï¼‰
});
```

---

### getSVGSize: ä½¿ç”¨è¿”å›å€¼

```cpp
jsi::Object getSVGSize(rt, tag, options)
//            â†‘         â†‘    â†‘      â†‘
//         è¿”å›ç±»å‹   å·¥å…·  è¾“å…¥   è¾“å…¥
```

```typescript
// JavaScript
const result = module.getSVGSize(tag, options);
// result æ˜¯è¾“å‡ºï¼ˆé€šè¿‡è¿”å›å€¼ï¼‰
```

---

## âœ… æ­£ç¡®çš„ç†è§£

### `options` çš„è§’è‰²

**å½“å‰å®ç°**:
- âœ… **è¾“å…¥å‚æ•°**: JavaScript â†’ C++
- âŒ **ä¸æ˜¯è¾“å‡º**: ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¸ä¼šè¢«è¿”å›

**æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†ä¸æ¨è**:
- âŒ ä¿®æ”¹ `options` æ¥å®ç°"åŒå‘"
- âœ… ä½¿ç”¨è¿”å›å€¼æ¥ä¼ é€’è¾“å‡ºç»“æœ

---

### ä¼ å€¼æ–¹å‘å›¾ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ options (è¾“å…¥)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     C++      â”‚
â”‚              â”‚
â”‚  è¯»å– options â”‚
â”‚  åˆ›å»º result  â”‚
â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ result (è¾“å‡º)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¦ç‚¹**:
- `options`: å•å‘ï¼ˆè¾“å…¥ï¼‰
- `result`: å•å‘ï¼ˆè¾“å‡ºï¼‰
- æ¸…æ™°ã€å¯é¢„æµ‹ã€æ˜“ç»´æŠ¤

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024-12-19  
**é€‚ç”¨é¡¹ç›®**: rntpc_ios

