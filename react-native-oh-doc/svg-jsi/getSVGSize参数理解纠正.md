# getSVGSize å‚æ•°ç†è§£çº æ­£

## âŒ é”™è¯¯ç†è§£

```
jsi::Object getSVGSize(jsi::Runtime &rt, Int32_t tag, Object options)
                           â†‘                    â†‘           â†‘
                     JSä¼ ç»™C++çš„å¯¹è±¡    C++ä¼ ç»™JSçš„å¯¹è±¡  ç»„ä»¶ID
```

## âœ… æ­£ç¡®ç†è§£

```
jsi::Object getSVGSize(jsi::Runtime &rt, Int32_t tag, Object options)
                           â†‘                    â†‘           â†‘
                    æ¡†æ¶è‡ªåŠ¨ä¼ é€’çš„Runtime  JSâ†’C++(è¾“å…¥)  JSâ†’C++(è¾“å…¥)
```

---

## ğŸ” å‚æ•°è¯¦è§£

### å‚æ•° 1: `jsi::Runtime &rt`

**ä½ çš„ç†è§£**: JS ä¼ ç»™ C++ çš„å¯¹è±¡ âŒ

**æ­£ç¡®ç†è§£**: **æ¡†æ¶è‡ªåŠ¨ä¼ é€’çš„ Runtime æ¥å£**ï¼Œä¸æ˜¯æ•°æ®å¯¹è±¡

**ä½œç”¨**:
- ä¸æ˜¯ç”¨æ¥ä¼ é€’æ•°æ®çš„
- æ˜¯ JavaScript å¼•æ“çš„æ¥å£
- æ¡†æ¶è‡ªåŠ¨ä¼ é€’ï¼ŒJavaScript ä¸éœ€è¦ä¼ é€’
- ç”¨äºåˆ›å»º JSI å¯¹è±¡ã€ç±»å‹è½¬æ¢ç­‰æ“ä½œ

**ç¤ºä¾‹**:
```cpp
// rt ç”¨äºåˆ›å»ºå¯¹è±¡
jsi::Object result(rt);  // åˆ›å»ºå¯¹è±¡éœ€è¦ rt

// rt ç”¨äºç±»å‹è½¬æ¢
std::string str = value.asString(rt).utf8(rt);  // è½¬æ¢éœ€è¦ rt
```

**ä¼ é€’æ–¹å¼**:
- JavaScript **ä¸ä¼ é€’** `rt`
- æ¡†æ¶**è‡ªåŠ¨ä¼ é€’**ç»™ C++ å‡½æ•°

---

### å‚æ•° 2: `Int32_t tag`

**ä½ çš„ç†è§£**: ç»„ä»¶ ID âœ… **æ­£ç¡®ï¼**

**æ­£ç¡®ç†è§£**: JavaScript â†’ C++ çš„ä¼ å€¼ï¼ˆ**è¾“å…¥å‚æ•°**ï¼‰

**ä½œç”¨**:
- æ ‡è¯† SVG ç»„ä»¶çš„å”¯ä¸€ ID
- JavaScript ä¼ é€’ç»™ C++ çš„æ•°æ®

**JavaScript ç«¯**:
```typescript
const tag = findNodeHandle(svgRef.current);  // ä¾‹å¦‚: 1
const result = module.getSVGSize(tag, options);
//                              â†‘
//                        JavaScript â†’ C++
```

**C++ ç«¯æ¥æ”¶**:
```cpp
int32_t tagValue = *tag;  // æ¥æ”¶ JavaScript ä¼ æ¥çš„ tag
auto svgNode = SvgViewManager::getInstance().getSvgViewByTag(*tag);
```

---

### å‚æ•° 3: `Object options`

**ä½ çš„ç†è§£**: C++ ä¼ ç»™ JS çš„å¯¹è±¡ âŒ

**æ­£ç¡®ç†è§£**: JavaScript â†’ C++ çš„ä¼ å€¼ï¼ˆ**è¾“å…¥å‚æ•°**ï¼‰

**ä½œç”¨**:
- JavaScript ä¼ é€’ç»™ C++ çš„é…ç½®é€‰é¡¹
- ä¸æ˜¯è¿”å›å€¼ï¼Œæ˜¯è¾“å…¥å‚æ•°

**JavaScript ç«¯**:
```typescript
const options = {
  unit: 'px',
  scale: 1.5,
  includeAspectRatio: true
};
const result = module.getSVGSize(tag, options);
//                                    â†‘
//                              JavaScript â†’ C++
```

**C++ ç«¯æ¥æ”¶**:
```cpp
if (options.has_value()) {
    const jsi::Object& opts = *options;  // æ¥æ”¶ JavaScript ä¼ æ¥çš„ options
    // è¯»å–é…ç½®...
}
```

---

## ğŸ“¤ğŸ“¥ æ­£ç¡®çš„ä¼ å€¼æ–¹å‘

### JavaScript â†’ C++ï¼ˆè¾“å…¥ï¼‰

```
JavaScript è°ƒç”¨
  getSVGSize(tag, options)
    â†“
ã€è¾“å…¥å‚æ•°ã€‘
  - tag: 1 (number)
  - options: { unit: 'px', scale: 1.5 } (object)
    â†“
C++ æ¥æ”¶
  - tag â†’ Int32_t
  - options â†’ Object
```

### C++ â†’ JavaScriptï¼ˆè¾“å‡ºï¼‰

```
C++ æ‰§è¡Œå®Œæˆå
    â†“
ã€è¿”å›å€¼ã€‘
  return jsi::Object result;
    â†“
JavaScript æ¥æ”¶
  const result = module.getSVGSize(tag, options);
  // result æ˜¯ C++ è¿”å›çš„å¯¹è±¡
```

---

## ğŸ”„ å®Œæ•´ä¼ å€¼æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript è°ƒç”¨                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  const tag = 1;                                             â”‚
â”‚  const options = { unit: 'px', scale: 1.5 };               â”‚
â”‚  const result = module.getSVGSize(tag, options);           â”‚
â”‚                              â†‘        â†‘                     â”‚
â”‚                        JavaScript â†’ C++                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¡¥æ¥å‡½æ•°                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  - rt: æ¡†æ¶è‡ªåŠ¨ä¼ é€’ï¼ˆä¸æ˜¯ JS ä¼ çš„ï¼‰                         â”‚
â”‚  - tag: ä» args[0] è§£æï¼ˆJS â†’ C++ï¼‰                        â”‚
â”‚  - options: ä» args[1] è§£æï¼ˆJS â†’ C++ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C++ å‡½æ•°æ‰§è¡Œ                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  jsi::Object getSVGSize(rt, tag, options) {                â”‚
â”‚      // rt: æ¡†æ¶è‡ªåŠ¨ä¼ é€’ï¼Œç”¨äºåˆ›å»ºå¯¹è±¡ã€ç±»å‹è½¬æ¢            â”‚
â”‚      // tag: JavaScript ä¼ æ¥çš„ç»„ä»¶ ID                       â”‚
â”‚      // options: JavaScript ä¼ æ¥çš„é…ç½®                      â”‚
â”‚                                                              â”‚
â”‚      // åˆ›å»ºè¿”å›å¯¹è±¡                                         â”‚
â”‚      jsi::Object result(rt);                                â”‚
â”‚      // ... è®¾ç½®å±æ€§ ...                                    â”‚
â”‚      return result;  // C++ â†’ JavaScript                    â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ C++ â†’ JavaScript
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript æ¥æ”¶è¿”å›å€¼                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  const result = {                                           â”‚
â”‚    width: 150,                                              â”‚
â”‚    height: 150,                                             â”‚
â”‚    success: true                                            â”‚
â”‚  };                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å‚æ•°ä¼ å€¼æ–¹å‘æ€»ç»“

| å‚æ•° | ä½ çš„ç†è§£ | æ­£ç¡®ç†è§£ | ä¼ å€¼æ–¹å‘ |
|------|----------|----------|----------|
| `rt` | JS ä¼ ç»™ C++ çš„å¯¹è±¡ | æ¡†æ¶è‡ªåŠ¨ä¼ é€’çš„ Runtime | âŒ ä¸æ˜¯ä¼ å€¼ |
| `tag` | ç»„ä»¶ ID âœ… | JavaScript â†’ C++ï¼ˆè¾“å…¥ï¼‰ | âœ… æ­£ç¡® |
| `options` | C++ ä¼ ç»™ JS çš„å¯¹è±¡ | JavaScript â†’ C++ï¼ˆè¾“å…¥ï¼‰ | âŒ é”™è¯¯ |
| **è¿”å›å€¼** | - | C++ â†’ JavaScriptï¼ˆè¾“å‡ºï¼‰ | âœ… æ­£ç¡® |

---

## ğŸ’¡ å…³é”®çº æ­£

### 1. `rt` ä¸æ˜¯æ•°æ®å‚æ•°

```cpp
// âŒ é”™è¯¯ç†è§£ï¼šrt æ˜¯ JavaScript ä¼ çš„æ•°æ®
// âœ… æ­£ç¡®ç†è§£ï¼šrt æ˜¯æ¡†æ¶è‡ªåŠ¨ä¼ é€’çš„å·¥å…·æ¥å£

// JavaScript è°ƒç”¨æ—¶ï¼š
module.getSVGSize(tag, options);
// ä¸éœ€è¦ä¼  rtï¼Œæ¡†æ¶è‡ªåŠ¨ä¼ é€’

// C++ å‡½æ•°ä¸­ï¼š
jsi::Object result(rt);  // rt ç”¨äºåˆ›å»ºå¯¹è±¡
std::string str = value.asString(rt).utf8(rt);  // rt ç”¨äºç±»å‹è½¬æ¢
```

---

### 2. `options` æ˜¯è¾“å…¥ï¼Œä¸æ˜¯è¾“å‡º

```cpp
// âŒ é”™è¯¯ç†è§£ï¼šoptions æ˜¯ C++ ä¼ ç»™ JS çš„
// âœ… æ­£ç¡®ç†è§£ï¼šoptions æ˜¯ JS ä¼ ç»™ C++ çš„è¾“å…¥å‚æ•°

// JavaScript ç«¯ï¼š
const options = { unit: 'px' };  // JS å‡†å¤‡æ•°æ®
module.getSVGSize(tag, options);  // JS â†’ C++

// C++ ç«¯ï¼š
if (options.has_value()) {
    // è¯»å– JS ä¼ æ¥çš„é…ç½®ï¼ˆè¾“å…¥ï¼‰
    const jsi::Object& opts = *options;
}

// è¿”å›å€¼æ‰æ˜¯ C++ â†’ JavaScriptï¼ˆè¾“å‡ºï¼‰
return result;  // C++ â†’ JS
```

---

### 3. è¿”å›å€¼æ‰æ˜¯ C++ â†’ JavaScript

```cpp
// C++ å‡½æ•°è¿”å›
jsi::Object getSVGSize(...) {
    jsi::Object result(rt);
    // ... è®¾ç½®å±æ€§ ...
    return result;  // â† è¿™æ‰æ˜¯ C++ â†’ JavaScript
}

// JavaScript æ¥æ”¶
const result = module.getSVGSize(tag, options);
// result æ˜¯ C++ è¿”å›çš„å¯¹è±¡ï¼ˆè¾“å‡ºï¼‰
```

---

## âœ… æ­£ç¡®çš„ç†è§£

```
jsi::Object getSVGSize(
    jsi::Runtime &rt,        // 1. æ¡†æ¶è‡ªåŠ¨ä¼ é€’çš„å·¥å…·æ¥å£ï¼ˆä¸æ˜¯æ•°æ®ï¼‰
    Int32_t tag,             // 2. JavaScript â†’ C++ï¼ˆè¾“å…¥ï¼šç»„ä»¶ IDï¼‰
    Object options)          // 3. JavaScript â†’ C++ï¼ˆè¾“å…¥ï¼šé…ç½®é€‰é¡¹ï¼‰
{
    // å‡½æ•°å†…éƒ¨ä½¿ç”¨ rt åˆ›å»ºè¿”å›å¯¹è±¡
    jsi::Object result(rt);
    
    // è¿”å›å€¼ï¼šC++ â†’ JavaScriptï¼ˆè¾“å‡ºï¼šç»“æœå¯¹è±¡ï¼‰
    return result;
}
```

**ä¼ å€¼æ–¹å‘**:
- **è¾“å…¥**: `tag` (JS â†’ C++), `options` (JS â†’ C++)
- **è¾“å‡º**: è¿”å›å€¼ `jsi::Object` (C++ â†’ JS)
- **å·¥å…·**: `rt` (æ¡†æ¶è‡ªåŠ¨ä¼ é€’ï¼Œä¸æ˜¯æ•°æ®)

---

## ğŸ¯ å¯¹æ¯” toDataURL

### toDataURL (å¼‚æ­¥ï¼Œä½¿ç”¨å›è°ƒ)

```cpp
void toDataURL(rt, tag, options, callback)
//            â†‘    â†‘      â†‘         â†‘
//         å·¥å…·  è¾“å…¥   è¾“å…¥      è¾“å‡ºæ–¹å¼ï¼ˆå›è°ƒï¼‰
```

**ä¼ å€¼æ–¹å‘**:
- è¾“å…¥: `tag`, `options` (JS â†’ C++)
- è¾“å‡º: é€šè¿‡ `callback` (C++ â†’ JS)

---

### getSVGSize (åŒæ­¥ï¼Œç›´æ¥è¿”å›)

```cpp
jsi::Object getSVGSize(rt, tag, options)
//            â†‘         â†‘    â†‘      â†‘
//         è¿”å›ç±»å‹   å·¥å…·  è¾“å…¥   è¾“å…¥
```

**ä¼ å€¼æ–¹å‘**:
- è¾“å…¥: `tag`, `options` (JS â†’ C++)
- è¾“å‡º: è¿”å›å€¼ `jsi::Object` (C++ â†’ JS)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024-12-19  
**é€‚ç”¨é¡¹ç›®**: rntpc_ios

